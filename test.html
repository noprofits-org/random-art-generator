<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Random Art Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
        }
        button {
            padding: 10px 20px;
            background-color: #0062cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Random Art Generator - Test Page</h1>
    
    <div class="test-section">
        <h2>Test 1: Check JavaScript Loading</h2>
        <div id="jsTest" class="status warning">Testing JavaScript modules...</div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: API Connection</h2>
        <button onclick="testAPI()">Test API Connection</button>
        <div id="apiTest" class="status warning">Click button to test API</div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Random Artwork</h2>
        <button onclick="testRandomArtwork()">Get Random Artwork</button>
        <div id="artworkTest" class="status warning">Click button to test</div>
    </div>
    
    <div class="test-section">
        <h2>Test 4: Check for Errors</h2>
        <div id="errorTest" class="status warning">Checking console for errors...</div>
    </div>

    <script>
        // Test JavaScript loading
        window.addEventListener('load', () => {
            const jsTest = document.getElementById('jsTest');
            const modules = ['MetConfig', 'MetAPI', 'MetUI', 'MetArtwork', 'MetFavorites'];
            const missing = [];
            
            modules.forEach(module => {
                if (!window[module]) {
                    missing.push(module);
                }
            });
            
            if (missing.length === 0) {
                jsTest.className = 'status success';
                jsTest.textContent = 'All modules loaded successfully!';
            } else {
                jsTest.className = 'status error';
                jsTest.textContent = 'Missing modules: ' + missing.join(', ');
            }
            
            // Check for console errors
            checkForErrors();
        });
        
        // Test API connection
        async function testAPI() {
            const apiTest = document.getElementById('apiTest');
            apiTest.textContent = 'Testing API connection...';
            apiTest.className = 'status warning';
            
            try {
                if (!window.MetAPI) {
                    throw new Error('MetAPI module not loaded');
                }
                
                const result = await window.MetAPI.testAPIConnection();
                if (result) {
                    apiTest.className = 'status success';
                    apiTest.textContent = 'API connection successful!';
                } else {
                    apiTest.className = 'status error';
                    apiTest.textContent = 'API connection failed';
                }
            } catch (error) {
                apiTest.className = 'status error';
                apiTest.textContent = 'Error: ' + error.message;
            }
        }
        
        // Test random artwork
        async function testRandomArtwork() {
            const artworkTest = document.getElementById('artworkTest');
            artworkTest.textContent = 'Fetching random artwork...';
            artworkTest.className = 'status warning';
            
            try {
                if (!window.MetAPI) {
                    throw new Error('MetAPI module not loaded');
                }
                
                const artwork = await window.MetAPI.getRandomArtwork({});
                if (artwork && artwork.objectID) {
                    artworkTest.className = 'status success';
                    artworkTest.textContent = `Success! Got artwork: ${artwork.title || 'Untitled'} (ID: ${artwork.objectID})`;
                } else {
                    artworkTest.className = 'status error';
                    artworkTest.textContent = 'No artwork returned';
                }
            } catch (error) {
                artworkTest.className = 'status error';
                artworkTest.textContent = 'Error: ' + error.message;
            }
        }
        
        // Check for console errors
        function checkForErrors() {
            const errorTest = document.getElementById('errorTest');
            const originalError = window.onerror;
            let hasErrors = false;
            
            window.onerror = function(msg, url, lineNo, columnNo, error) {
                hasErrors = true;
                errorTest.className = 'status error';
                errorTest.textContent = 'JavaScript error detected: ' + msg;
                if (originalError) {
                    return originalError(msg, url, lineNo, columnNo, error);
                }
            };
            
            // Check if filters or search are being referenced
            setTimeout(() => {
                if (!hasErrors) {
                    if (window.MetFilters || window.MetSearch) {
                        errorTest.className = 'status warning';
                        errorTest.textContent = 'Warning: Filter/Search modules still present';
                    } else {
                        errorTest.className = 'status success';
                        errorTest.textContent = 'No errors detected!';
                    }
                }
            }, 1000);
        }
    </script>
    
    <!-- Load the app scripts -->
    <script src="./config.js"></script>
    <script src="./state-manager.js"></script>
    <script src="./error-handler.js"></script>
    <script src="./event-manager.js"></script>
    <script src="./utils.js"></script>
    <script src="./virtual-scroll.js"></script>
    <script src="./api.js"></script>
    <script src="./favorites.js"></script>
    <script src="./artwork.js"></script>
    <script src="./ui.js"></script>
    <script src="./init.js"></script>
</body>
</html>