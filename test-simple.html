<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Simplified Random Art Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        button {
            padding: 10px 20px;
            background-color: #0062cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .module-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .module {
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        .loaded {
            background-color: #d4edda;
            color: #155724;
        }
        .missing {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Simplified Random Art Generator - Test Page</h1>
    
    <div class="test-section">
        <h2>Module Loading Status</h2>
        <div id="moduleStatus" class="module-list"></div>
    </div>
    
    <div class="test-section">
        <h2>Core Functionality Tests</h2>
        
        <button onclick="testAPI()">Test API Connection</button>
        <div id="apiStatus" class="status info">Click to test API connection</div>
        
        <button onclick="testRandomArtwork()">Get Random Artwork</button>
        <div id="artworkStatus" class="status info">Click to fetch a random artwork</div>
        
        <button onclick="testFavorites()">Test Favorites DB</button>
        <div id="favoritesStatus" class="status info">Click to test favorites database</div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="consoleOutput" style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
            <div style="color: #666;">Console messages will appear here...</div>
        </div>
    </div>

    <script>
        // Override console.log to display in UI
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('consoleOutput');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('LOG', args.join(' '), '#0066cc');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('ERROR', args.join(' '), '#cc0000');
        };
        
        function addToConsole(type, message, color) {
            const entry = document.createElement('div');
            entry.style.marginBottom = '4px';
            entry.innerHTML = `<span style="color: ${color}; font-weight: bold;">[${type}]</span> ${message}`;
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        // Check module loading
        function checkModules() {
            const modules = [
                { name: 'MetConfig', loaded: typeof window.MetConfig !== 'undefined' },
                { name: 'MetAPI', loaded: typeof window.MetAPI !== 'undefined' },
                { name: 'MetFavorites', loaded: typeof window.MetFavorites !== 'undefined' },
                { name: 'MetArtwork', loaded: typeof window.MetArtwork !== 'undefined' },
                { name: 'MetUI', loaded: typeof window.MetUI !== 'undefined' },
                { name: 'MetEventManager', loaded: typeof window.MetEventManager !== 'undefined' },
                { name: 'MetUtils', loaded: typeof window.MetUtils !== 'undefined' },
                { name: 'SimpleInit', loaded: typeof window.SimpleInit !== 'undefined' }
            ];
            
            const statusDiv = document.getElementById('moduleStatus');
            statusDiv.innerHTML = '';
            
            modules.forEach(module => {
                const div = document.createElement('div');
                div.className = `module ${module.loaded ? 'loaded' : 'missing'}`;
                div.textContent = `${module.name}: ${module.loaded ? '✓' : '✗'}`;
                statusDiv.appendChild(div);
            });
            
            const allLoaded = modules.every(m => m.loaded);
            console.log(`Module check: ${allLoaded ? 'All modules loaded' : 'Some modules missing'}`);
        }
        
        // Test API connection
        async function testAPI() {
            const status = document.getElementById('apiStatus');
            status.className = 'status info';
            status.textContent = 'Testing API connection...';
            
            try {
                if (!window.MetAPI) {
                    throw new Error('MetAPI not loaded');
                }
                
                const connected = await window.MetAPI.testAPIConnection();
                status.className = 'status success';
                status.textContent = connected ? 'API connection successful!' : 'API connection failed';
            } catch (error) {
                status.className = 'status error';
                status.textContent = 'Error: ' + error.message;
            }
        }
        
        // Test random artwork
        async function testRandomArtwork() {
            const status = document.getElementById('artworkStatus');
            status.className = 'status info';
            status.textContent = 'Fetching random artwork...';
            
            try {
                if (!window.MetAPI) {
                    throw new Error('MetAPI not loaded');
                }
                
                const artwork = await window.MetAPI.getRandomArtwork();
                if (artwork) {
                    status.className = 'status success';
                    status.textContent = `Success! Got: "${artwork.title || 'Untitled'}" by ${artwork.artistDisplayName || 'Unknown'}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'No artwork returned';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = 'Error: ' + error.message;
            }
        }
        
        // Test favorites
        async function testFavorites() {
            const status = document.getElementById('favoritesStatus');
            status.className = 'status info';
            status.textContent = 'Testing favorites database...';
            
            try {
                if (!window.MetFavorites) {
                    throw new Error('MetFavorites not loaded');
                }
                
                await window.MetFavorites.init();
                const count = await window.MetFavorites.getFavoritesCount();
                status.className = 'status success';
                status.textContent = `Favorites database working! Current count: ${count}`;
            } catch (error) {
                status.className = 'status error';
                status.textContent = 'Error: ' + error.message;
            }
        }
        
        // Run module check on load
        window.addEventListener('load', () => {
            setTimeout(checkModules, 100);
        });
    </script>
    
    <!-- Load simplified modules -->
    <script src="./config.js"></script>
    <script src="./event-manager.js"></script>
    <script src="./utils.js"></script>
    <script src="./api-simple.js"></script>
    <script src="./favorites.js"></script>
    <script src="./artwork-simple.js"></script>
    <script src="./ui-simple.js"></script>
    <script src="./init-simple.js"></script>
</body>
</html>